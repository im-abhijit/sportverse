import{j as e}from"./ui-B75sWwG2.js";import{e as me,u as ue,r as l}from"./vendor-CNUPXUkP.js";import{u as i,B as g,C as G,b as he,d as xe,e as pe,a as J,c as K}from"./index-B1V6OKtR.js";import{C as ge}from"./calendar-Dsk0swh7.js";import{P as je,a as fe,b as Se}from"./popover-Yv56D1MC.js";import{L as h,I as O}from"./label-B0yGnVM1.js";import{S as P,a as b,b as T,c as C,d as m}from"./select-C-Bdqa44.js";import{g as ve,d as Ne,b as ye}from"./slotsApi-DFcxD0X-.js";import{A as we}from"./api-BW-Pu9pH.js";import{g as S,A as Pe,C as be,k as Q,h as Te,X as W,l as Ce}from"./utils-E33ow1TR.js";const Le=()=>{const{venueId:d}=me(),j=ue();l.useEffect(()=>{const s=localStorage.getItem("partnerId"),t=localStorage.getItem("isPartnerLoggedIn");if(!s||t!=="true"){i.error("Please login to access this page"),j("/partner/login");return}},[j]);const[A,Y]=l.useState(null),[o,Z]=l.useState(new Date),[v,$]=l.useState([]),[E,F]=l.useState(!1),[V,B]=l.useState(!1),[ee,L]=l.useState(null),[x,H]=l.useState(""),[p,_]=l.useState(""),[N,R]=l.useState("AM"),[y,z]=l.useState("30"),[U,X]=l.useState(""),[w,q]=l.useState(""),[u,k]=l.useState([]),se=(s,t,r)=>{let a=parseInt(s)||0;const n=parseInt(t)||0;return r==="AM"?a===12&&(a=0):a!==12&&(a+=12),`${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}`},I=s=>{const[t,r]=s.split(":").map(Number);let a=t%12;a===0&&(a=12);const n=t<12?"AM":"PM";return{hour:String(a),minute:String(r).padStart(2,"0"),amPm:n}},te=(s,t)=>{const[r,a]=s.split(":").map(Number),n=r*60+a+t,c=Math.floor(n/60)%24,f=n%60;return`${String(c).padStart(2,"0")}:${String(f).padStart(2,"0")}`};l.useEffect(()=>{if(!d){i.error("Venue ID not found"),j("/partner/dashboard");return}(async()=>{try{const t=await fetch(`${we}/api/venues/${d}`,{headers:{Accept:"application/json","ngrok-skip-browser-warning":"true"}});if(t.ok){const r=await t.json();r.success&&r.data&&Y(r.data)}}catch{}})()},[d,j]),l.useEffect(()=>{o&&d&&M()},[o,d]);const M=async()=>{var t;if(!o||!d)return;const s=S(o,"yyyy-MM-dd");F(!0);try{const r=await ve(d,s);if(r.success&&((t=r.data)!=null&&t.slots)){const a=r.data.slots.map(n=>({startTime:n.startTime,endTime:n.endTime,slotId:n.slotId,price:n.price,booked:n.booked||n.isBooked}));$(a)}else $([])}catch{$([])}finally{F(!1)}},ae=()=>{if(!x||!p){i.error("Please enter a start time");return}const s=parseInt(x),t=parseInt(p);if(isNaN(s)||s<1||s>12){i.error("Please enter a valid hour (1-12)");return}if(isNaN(t)||t<0||t>59){i.error("Please enter a valid minute (0-59)");return}const r=parseInt(y==="custom"?U:y);if(isNaN(r)||r<=0){i.error("Please enter a valid duration");return}if(!w||parseFloat(w)<=0){i.error("Please enter a valid price");return}const a=se(x,p,N),n=te(a,r),c=I(n),f=`${x}:${p.padStart(2,"0")}`,D=`${c.hour}:${c.minute}`,le=`${x}:${p.padStart(2,"0")} ${N}`,oe=`${c.hour}:${c.minute} ${c.amPm}`,ce=`${Date.now()}-${Math.random()}`;k(de=>[...de,{startTime:f,endTime:D,startTimeAmPm:N,endTimeAmPm:c.amPm,duration:r,price:parseFloat(w),id:ce,displayTime:`${le} - ${oe}`}]),H(""),_(""),R("AM"),z("30"),X(""),q("")},re=s=>{k(t=>t.filter(r=>r.id!==s))},ne=async s=>{if(!o||!d||!s){i.error("Missing information to delete slot");return}const t=v.find(a=>a.slotId===s);if(t&&(t.booked||t.isBooked)){i.error("Cannot delete a booked slot");return}if(!confirm("Are you sure you want to delete this slot?"))return;L(s);const r=S(o,"yyyy-MM-dd");try{const a=await Ne(d,r,s);a.success?(i.success("Slot deleted successfully"),await M()):i.error(a.message||"Failed to delete slot")}catch(a){i.error((a==null?void 0:a.message)||"Failed to delete slot. Please try again.")}finally{L(null)}},ie=async()=>{if(!o||!d){i.error("Please select a date");return}if(u.length===0){i.error("Please add at least one slot to save");return}B(!0);const s=S(o,"yyyy-MM-dd");try{const t=u.map(a=>({slotId:`${a.startTime}-${a.endTime}`,startTime:a.startTime,endTime:a.endTime,startTimeAmPm:a.startTimeAmPm,endTimeAmPm:a.endTimeAmPm,price:a.price,isBooked:!1})),r=await ye({venueId:d,date:s,slots:t});r.success?(i.success(r.message||"Slots saved successfully"),k([]),await M()):i.error(r.message||"Failed to save slots")}catch(t){const r=(t==null?void 0:t.message)||"Failed to save slots. Please try again.";i.error(r)}finally{B(!1)}};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto px-4 md:px-6 py-6 md:py-8",children:[e.jsxs(g,{variant:"ghost",onClick:()=>j("/partner/dashboard"),className:"mb-4 md:mb-6",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs(G,{children:[e.jsxs(he,{children:[e.jsxs(xe,{className:"text-2xl",children:["Edit Venue: ",(A==null?void 0:A.name)||"Loading..."]}),e.jsx(pe,{children:"Add time slots for your venue. Select start time, duration, and price for each slot."})]}),e.jsxs(J,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Select Date"}),e.jsxs(je,{children:[e.jsx(fe,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:K("w-full justify-start text-left font-normal",!o&&"text-muted-foreground"),children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),o?S(o,"PPP"):"Pick a date"]})}),e.jsx(Se,{className:"w-auto p-0",align:"start",children:e.jsx(ge,{mode:"single",selected:o,onSelect:s=>s&&Z(s),disabled:s=>s<new Date(new Date().setHours(0,0,0,0)),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[e.jsx(Q,{className:"h-5 w-5 mr-2"}),"Add Time Slots for ",S(o,"PPP")]}),E&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading existing slots..."})]}),e.jsx(G,{className:"border-2 border-dashed",children:e.jsx(J,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3 md:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"startTime",children:"Start Time"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(P,{value:x,onValueChange:H,children:[e.jsx(b,{className:"w-20",children:e.jsx(T,{placeholder:"--"})}),e.jsx(C,{children:Array.from({length:12},(s,t)=>t+1).map(s=>e.jsx(m,{value:String(s),children:s},s))})]}),e.jsx("span",{className:"text-muted-foreground",children:":"}),e.jsxs(P,{value:p,onValueChange:_,children:[e.jsx(b,{className:"w-20",children:e.jsx(T,{placeholder:"--"})}),e.jsx(C,{children:Array.from({length:60},(s,t)=>String(t).padStart(2,"0")).map(s=>e.jsx(m,{value:s,children:s},s))})]}),e.jsxs(P,{value:N,onValueChange:s=>R(s),children:[e.jsx(b,{className:"w-20",children:e.jsx(T,{})}),e.jsxs(C,{children:[e.jsx(m,{value:"AM",children:"AM"}),e.jsx(m,{value:"PM",children:"PM"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"duration",children:"Duration (minutes)"}),e.jsxs(P,{value:y,onValueChange:z,children:[e.jsx(b,{id:"duration",children:e.jsx(T,{placeholder:"Select duration"})}),e.jsxs(C,{children:[e.jsx(m,{value:"30",children:"30 minutes"}),e.jsx(m,{value:"60",children:"60 minutes"}),e.jsx(m,{value:"90",children:"90 minutes"}),e.jsx(m,{value:"custom",children:"Custom"})]})]}),y==="custom"&&e.jsx(O,{type:"number",min:"1",placeholder:"Enter minutes",value:U,onChange:s=>X(s.target.value),className:"mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"price",children:"Price (₹)"}),e.jsx(O,{id:"price",type:"number",min:"0",step:"0.01",placeholder:"Enter price",value:w,onChange:s=>q(s.target.value),className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:" "}),e.jsxs(g,{onClick:ae,className:"w-full",variant:"outline",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Add Slot"]})]})]})})}),u.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(h,{className:"text-base font-semibold",children:["Slots to Save (",u.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:u.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.displayTime}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Duration: ",s.duration," minutes • Price: ₹",s.price]})]}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>re(s.id),className:"ml-2",children:e.jsx(W,{className:"h-4 w-4"})})]},s.id))})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[u.length," slot(s) ready to save"]}),e.jsx(g,{onClick:ie,disabled:V||u.length===0,className:"min-w-[120px]",children:V?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Save Slots"]})})]}),!E&&v.length>0&&e.jsxs("div",{className:"space-y-2 pt-4 border-t",children:[e.jsxs(h,{className:"text-base font-semibold",children:["Existing Slots (",v.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-2 md:gap-3",children:v.map((s,t)=>{const r=s.booked||s.isBooked,a=ee===s.slotId,n=I(s.startTime),c=I(s.endTime),f=`${n.hour}:${n.minute} ${n.amPm}`,D=`${c.hour}:${c.minute} ${c.amPm}`;return e.jsxs("div",{className:K("p-2 border rounded text-sm flex items-center justify-between",r?"bg-muted/50 opacity-60":"bg-background"),children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium",children:[f," - ",D]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:r?e.jsx("span",{className:"text-destructive",children:"Booked"}):e.jsxs(e.Fragment,{children:["Price: ₹",s.price||0]})})]}),!r&&s.slotId&&e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>ne(s.slotId),disabled:a,className:"ml-2 h-6 w-6 text-destructive hover:text-destructive hover:bg-destructive/10",children:a?e.jsx(Q,{className:"h-3 w-3 animate-spin"}):e.jsx(W,{className:"h-3 w-3"})})]},t)})})]})]})]})]})})]})})};export{Le as default};
