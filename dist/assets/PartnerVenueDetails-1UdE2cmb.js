import{j as e}from"./ui-B75sWwG2.js";import{u as he,e as ge,r as l}from"./vendor-CNUPXUkP.js";import{u as n,B as o,C as pe,b as xe,a as fe}from"./index-B1V6OKtR.js";import{L as p,I as x}from"./label-B0yGnVM1.js";import{T as be}from"./textarea-CPwiB2lw.js";import{A as V}from"./api-BW-Pu9pH.js";import{g as P}from"./imageUtils-oRQLthwP.js";import{A as ve,M as je,a6 as te,h as w,X as ae,l as Ne,a7 as we,Z as ye,e as ke}from"./utils-E33ow1TR.js";const re=i=>new Promise((d,S)=>{const u=new FileReader;u.readAsDataURL(i),u.onload=()=>d(u.result),u.onerror=R=>S(R)}),De=()=>{const i=he(),{venueId:d}=ge(),[S,u]=l.useState(null),[R,z]=l.useState(!0),[M,O]=l.useState(!1),[y,_]=l.useState(""),[E,H]=l.useState(""),[F,K]=l.useState(""),[k,Z]=l.useState(""),[v,D]=l.useState([]),[L,J]=l.useState(""),[C,U]=l.useState([]),[j,Q]=l.useState([]),[$,X]=l.useState(""),[I,q]=l.useState(""),[B,T]=l.useState(""),[h,A]=l.useState(null),[f,N]=l.useState(null);l.useEffect(()=>{const s=localStorage.getItem("partnerId"),t=localStorage.getItem("isPartnerLoggedIn");if(!s||t!=="true"){n.error("Please login to access this page"),i("/partner/login");return}},[i]),l.useEffect(()=>{if(!d){n.error("Venue ID not found"),i("/partner/dashboard");return}(async()=>{z(!0);try{const t=await fetch(`${V}/api/venues/${d}`,{headers:{Accept:"application/json","ngrok-skip-browser-warning":"true"}});if(t.ok){const r=await t.json();if(r.success&&r.data){const a=r.data;u(a),_(a.name||""),H(a.description||""),K(a.addtress||a.address||""),Z(a.city||""),D(a.games||[]),U(a.photos||[]),Q(a.amenities||["Flood Lights","Parking"]),q(a.partnerMobileNo||""),T(a.upiId||""),A(a.qrCodeImage||null),a.qrCodeImage&&N(P(a.qrCodeImage)||null)}else n.error(r.message||"Failed to fetch venue details"),i("/partner/dashboard")}else n.error("Failed to fetch venue details"),i("/partner/dashboard")}catch{n.error("Failed to load venue details"),i("/partner/dashboard")}finally{z(!1)}})()},[d,i]);const ne=async s=>{const t=s.target.files;if(!(!t||t.length===0)){try{const r=[];for(let a=0;a<t.length;a++){const m=await re(t[a]);r.push(m)}U([...C,...r]),n.success(`${t.length} photo(s) added`)}catch{n.error("Failed to add photos")}s.target.value=""}},le=s=>{U(C.filter((t,r)=>r!==s)),n.success("Photo removed")},Y=()=>{L.trim()&&(D([...v,L.trim()]),J(""))},oe=s=>{D(v.filter((t,r)=>r!==s))},ee=()=>{if($.trim()){const s=$.trim();if(j.includes(s)){n.error("This amenity already exists");return}Q([...j,s]),X("")}},ie=s=>{Q(j.filter((t,r)=>r!==s))},de=async s=>{const t=s.target.files;if(!(!t||t.length===0)){try{const r=t[0],a=await re(r);A(a),N(URL.createObjectURL(r)),n.success("QR code image added")}catch{n.error("Failed to add QR code image")}s.target.value=""}},ce=()=>{A(null),f&&URL.revokeObjectURL(f),N(null),n.success("QR code image removed")},me=async()=>{if(!d)return;if(!y.trim()){n.error("Please enter a venue name");return}if(!E.trim()){n.error("Please enter a description");return}if(!F.trim()||!k.trim()){n.error("Please enter address and city");return}if(!I.trim()){n.error("Please enter WhatsApp number");return}if(I.replace(/\D/g,"").length<10){n.error("Please enter a valid WhatsApp number (at least 10 digits)");return}if(v.length===0){n.error("Please add at least one game");return}O(!0);try{const t=localStorage.getItem("partnerId"),r=C.map(g=>g.startsWith("data:")&&g.split(",")[1]||g);let a=null;h&&(h.startsWith("data:")?a=h.split(",")[1]||h:a=h);const m=I.trim().replace(/\s+/g,""),ue={name:y.trim(),description:E.trim(),games:v,amenities:j,location:`${F.trim()}, ${k.trim()}`,city:k.trim(),photos:r,partnerMobileNo:m,...a?{qrCodeImage:a}:{},...B.trim()?{upiId:B.trim()}:{},...t?{partnerId:t}:{},...d?{id:d,venueId:d}:{}},W=await fetch(`${V}/api/venues`,{method:"POST",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},body:JSON.stringify(ue)});if(!W.ok)throw new Error(`HTTP ${W.status}`);const c=await W.json();if(c!=null&&c.success){n.success((c==null?void 0:c.message)||"Venue updated successfully!");const g=await fetch(`${V}/api/venues/${d}`,{headers:{Accept:"application/json","ngrok-skip-browser-warning":"true"}});if(g.ok){const G=await g.json();if(G.success&&G.data){const b=G.data;u(b),q(b.partnerMobileNo||""),T(b.upiId||""),A(b.qrCodeImage||null),b.qrCodeImage?N(P(b.qrCodeImage)||null):(f&&URL.revokeObjectURL(f),N(null))}}}else n.error((c==null?void 0:c.message)||"Failed to update venue")}catch{n.error("Failed to update venue. Please try again.")}finally{O(!1)}};if(R)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-10 w-10 border-4 border-blue-600 border-t-transparent mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading venue details..."})]})});if(!S)return null;const se=C.map(s=>P(s)).filter(Boolean);return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50/30 via-background to-green-50/30 dark:from-blue-950/20 dark:via-background dark:to-green-950/20",children:e.jsxs("div",{className:"container mx-auto px-4 md:px-6 py-6 md:py-8",children:[e.jsxs(o,{variant:"ghost",onClick:()=>i("/partner/dashboard"),className:"mb-6",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),e.jsx("div",{className:"max-w-6xl mx-auto space-y-6",children:e.jsxs(pe,{className:"border-2 shadow-lg border-blue-200/50 dark:border-blue-800/50",children:[e.jsx(xe,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"venueName",className:"text-sm font-medium text-muted-foreground",children:"Venue Name"}),e.jsx(x,{id:"venueName",value:y,onChange:s=>_(s.target.value),className:"text-2xl md:text-3xl font-bold mt-1 bg-gradient-to-r from-blue-600 to-green-600 dark:from-blue-400 dark:to-green-400 bg-clip-text text-transparent border-none focus-visible:ring-2",placeholder:"Enter venue name"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"venueAddress",className:"text-sm font-medium text-muted-foreground",children:"Address"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(je,{className:"h-4 w-4 text-blue-600 dark:text-blue-400 flex-shrink-0"}),e.jsx(x,{id:"venueAddress",value:F,onChange:s=>K(s.target.value),placeholder:"Enter address"})]})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"venueCity",className:"text-sm font-medium text-muted-foreground",children:"City"}),e.jsx(x,{id:"venueCity",value:k,onChange:s=>Z(s.target.value),placeholder:"Enter city",className:"mt-1"})]})]})]})}),e.jsxs(fe,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"venueDescription",className:"text-lg font-semibold mb-2 block",children:"Description"}),e.jsx(be,{id:"venueDescription",value:E,onChange:s=>H(s.target.value),placeholder:"Enter venue description",className:"min-h-[100px]"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"whatsappNumber",className:"text-base font-semibold",children:"WhatsApp Number for Booking Verification *"}),e.jsx(x,{id:"whatsappNumber",type:"tel",value:I,onChange:s=>q(s.target.value),placeholder:"e.g., +91 9876543210",className:"mt-2"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This number will be used for booking verification"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"upiId",className:"text-base font-semibold",children:"UPI ID"}),e.jsx(x,{id:"upiId",type:"text",value:B,onChange:s=>T(s.target.value),placeholder:"e.g., yourname@paytm",className:"mt-2"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"UPI ID for receiving payments"})]})]}),e.jsxs("div",{children:[e.jsx(p,{className:"text-base font-semibold",children:"QR Code Image"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 mb-3",children:"Upload QR code for payment"}),f||h?e.jsx("div",{className:"relative inline-block",children:e.jsxs("div",{className:"relative w-48 h-48 border-2 border-blue-200/50 dark:border-blue-800/50 rounded-lg overflow-hidden",children:[e.jsx("img",{loading:"lazy",decoding:"async",src:f||P(h||"")||"",alt:"QR Code",className:"w-full h-full object-cover"}),e.jsx(o,{variant:"destructive",size:"icon",className:"absolute top-2 right-2",onClick:ce,children:e.jsx(te,{className:"h-4 w-4"})})]})}):e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:"image/*",onChange:de,className:"hidden",id:"qr-code-upload"}),e.jsxs(o,{variant:"outline",onClick:()=>{var s;return(s=document.getElementById("qr-code-upload"))==null?void 0:s.click()},children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Upload QR Code"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Photos"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:ne,className:"hidden",id:"photo-upload"}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>{var s;return(s=document.getElementById("photo-upload"))==null?void 0:s.click()},children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Add Photos"]})]})]}),se.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",children:se.map((s,t)=>e.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden border-2 border-blue-200/50 dark:border-blue-800/50 group",children:[e.jsx("img",{loading:"lazy",decoding:"async",src:s,alt:`${y} - Photo ${t+1}`,className:"w-full h-full object-cover"}),e.jsx(o,{variant:"destructive",size:"icon",className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>le(t),children:e.jsx(te,{className:"h-4 w-4"})})]},t))}):e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-8 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No photos added yet"}),e.jsxs(o,{variant:"outline",onClick:()=>{var s;return(s=document.getElementById("photo-upload"))==null?void 0:s.click()},children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Add First Photo"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Games Available"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:v.map((s,t)=>e.jsxs("span",{className:"px-4 py-2 bg-gradient-to-r from-blue-100 to-green-100 dark:from-blue-900 dark:to-green-900 text-blue-700 dark:text-blue-300 rounded-lg text-sm font-medium flex items-center gap-2",children:[s,e.jsx(o,{variant:"ghost",size:"icon",className:"h-4 w-4 text-destructive hover:text-destructive",onClick:()=>oe(t),children:e.jsx(ae,{className:"h-3 w-3"})})]},t))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{value:L,onChange:s=>J(s.target.value),onKeyPress:s=>{s.key==="Enter"&&Y()},placeholder:"Add a game",className:"max-w-xs"}),e.jsxs(o,{variant:"outline",onClick:Y,children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Add Game"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Amenities"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:j.map((s,t)=>{const r=a=>{const m=a.toLowerCase();return m.includes("light")||m.includes("flood")?e.jsx(ye,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}):m.includes("parking")||m.includes("car")?e.jsx(ke,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}):null};return e.jsxs("span",{className:"px-4 py-2 bg-gradient-to-r from-blue-100 to-green-100 dark:from-blue-900 dark:to-green-900 text-blue-700 dark:text-blue-300 rounded-lg text-sm font-medium flex items-center gap-2",children:[r(s),s,e.jsx(o,{variant:"ghost",size:"icon",className:"h-4 w-4 text-destructive hover:text-destructive",onClick:()=>ie(t),children:e.jsx(ae,{className:"h-3 w-3"})})]},t)})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{value:$,onChange:s=>X(s.target.value),onKeyPress:s=>{s.key==="Enter"&&ee()},placeholder:"Add an amenity",className:"max-w-xs"}),e.jsxs(o,{variant:"outline",onClick:ee,children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Add Amenity"]})]})]}),e.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row gap-4 pt-6 border-t",children:[e.jsx(o,{onClick:me,disabled:M,className:"flex-1 bg-gradient-to-r from-blue-600 to-green-600 hover:from-blue-700 hover:to-green-700",children:M?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Save Changes"]})}),e.jsxs(o,{variant:"outline",onClick:()=>i(`/partner/edit-venue/${d}`),className:"flex-1",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Manage Slots"]}),e.jsx(o,{variant:"ghost",onClick:()=>i("/partner/dashboard"),className:"flex-1",children:"Back to Dashboard"})]})]})]})})]})})};export{De as default};
