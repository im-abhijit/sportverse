import{j as e,L as $,T as D,s as M,t as U}from"./ui-B75sWwG2.js";import{r as l,f as O}from"./vendor-CNUPXUkP.js";import{N as V}from"./Navbar-DzlbKMxI.js";import{c as A,C as h,a as C,B as T,b as J,d as _,u as x}from"./index-B1V6OKtR.js";import{L as P,I as k}from"./label-B0yGnVM1.js";import{B as H,g as q}from"./bookingsApi-CmDUl_UW.js";import{S as f}from"./skeleton-CC-56ifn.js";import{E as z}from"./EmptyState-DlEQOQRq.js";import{S as Y,a as G,b as K,c as Q,d as W}from"./select-C-Bdqa44.js";import{A as X}from"./api-BW-Pu9pH.js";import{P as Z,M as ee,C as se}from"./utils-E33ow1TR.js";import"./authApi-CqZS-amf.js";const te=U,R=l.forwardRef(({className:n,...a},i)=>e.jsx($,{ref:i,className:A("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",n),...a}));R.displayName=$.displayName;const E=l.forwardRef(({className:n,...a},i)=>e.jsx(D,{ref:i,className:A("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",n),...a}));E.displayName=D.displayName;const I=l.forwardRef(({className:n,...a},i)=>e.jsx(M,{ref:i,className:A("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",n),...a}));I.displayName=M.displayName;async function ae(n,a,i,d){const g=`${X}/api/users/update`,r=await fetch(g,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","ngrok-skip-browser-warning":"true"},body:JSON.stringify({userId:n,name:a,city:i,mobileNumber:d})});if(!r.ok){const m=await r.text().catch(()=>"");throw new Error(`HTTP ${r.status}: ${m.slice(0,200)}`)}if(!(r.headers.get("content-type")||"").includes("application/json")){const m=await r.text().catch(()=>"");throw new Error(`Non-JSON response: ${m.slice(0,200)}`)}return r.json()}const he=()=>{const n=O(),[a,i]=l.useState("John Doe"),[d,g]=l.useState("+91 9876543210"),[r,j]=l.useState("Bareilly"),[m,B]=l.useState(!1),[N,y]=l.useState([]),[v,L]=l.useState(!1),[p,b]=l.useState(null);l.useEffect(()=>{const s=localStorage.getItem("userName");s&&i(s);const t=localStorage.getItem("userCity");t&&j(t);const o=localStorage.getItem("userPhoneNumber");o&&g(o);const u=o||d;if(!u||u.trim().length<10){b("Mobile number not found. Please login again.");return}(async()=>{L(!0),b(null);try{const c=await q(u);c.success&&Array.isArray(c.data)?y(c.data):y([])}catch(c){b((c==null?void 0:c.message)||"Failed to load bookings"),y([])}finally{L(!1)}})()},[n.pathname,d]);const F=s=>{switch(s){case"confirmed":return"bg-primary";case"completed":return"bg-green-500";case"cancelled":return"bg-destructive";default:return"bg-muted"}},w=s=>{const t=(s.bookingStatus||"").toUpperCase(),o=(s.paymentStatus||"").toUpperCase();return t==="PAID"||o==="SUCCESS"?"confirmed":t==="COMPLETED"?"completed":t==="CANCELLED"?"cancelled":(s.bookingStatus||o||"").toString().toLowerCase()||"pending"};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(V,{}),e.jsxs("div",{className:"container mx-auto px-4 py-6 md:py-8",children:[e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-4xl font-bold mb-6 md:mb-8",children:"My Dashboard"}),e.jsxs(te,{defaultValue:"bookings",className:"space-y-4 md:space-y-6",children:[e.jsxs(R,{className:"grid w-full max-w-md grid-cols-2",children:[e.jsx(E,{value:"bookings",children:"My Bookings"}),e.jsx(E,{value:"profile",children:"Profile"})]}),e.jsxs(I,{value:"bookings",className:"space-y-6",children:[v&&e.jsx("div",{className:"grid gap-3 md:gap-4",children:[...Array(3)].map((s,t)=>e.jsx(h,{className:"overflow-hidden",children:e.jsx(C,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(f,{className:"h-6 w-3/4"}),e.jsx(f,{className:"h-6 w-20"})]}),e.jsx(f,{className:"h-4 w-1/2"}),e.jsx(f,{className:"h-4 w-2/3"})]}),e.jsx(f,{className:"h-16 w-24 md:w-32"})]})})},t))}),p&&e.jsxs(h,{className:"p-6 text-center",children:[e.jsx("p",{className:"text-sm md:text-base text-destructive mb-4",children:p}),e.jsx(T,{onClick:()=>window.location.reload(),children:"Retry"})]}),!v&&!p&&N.length===0&&e.jsx(z,{icon:Z,title:"No bookings found",description:"You haven't made any bookings yet. Start exploring venues to book your first slot!"}),!v&&!p&&N.length>0&&e.jsx("div",{className:"grid gap-3 md:gap-4",children:N.map(s=>{var t,o,u;return e.jsx(h,{className:"overflow-hidden",children:e.jsx(C,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 md:gap-4",children:[e.jsxs("div",{className:"space-y-3 flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:((t=s.venue)==null?void 0:t.name)||"Venue"}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(ee,{className:"h-4 w-4 mr-1"}),`${((o=s.venue)==null?void 0:o.city)||""}${(u=s.venue)!=null&&u.addtress?", "+s.venue.addtress:""}`]})]}),e.jsx(H,{className:`${F(w(s))} text-white`,children:w(s)})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center text-muted-foreground",children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),s.date]}),e.jsxs("div",{className:"text-muted-foreground",children:["Slot: ",Array.isArray(s.slots)&&s.slots.length>0?s.slots.map(S=>`${S.startTime} - ${S.endTime}`).join(", "):"-"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 md:flex-col md:items-end",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["â‚¹",s.amount]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Amount"})]}),w(s)==="confirmed"&&e.jsx(T,{variant:"outline",size:"sm",children:"View Details"})]})]})})},s.id)})})]}),e.jsx(I,{value:"profile",children:e.jsxs(h,{children:[e.jsx(J,{children:e.jsx(_,{children:"Profile Information"})}),e.jsxs(C,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"name",children:"Full Name"}),e.jsx(k,{id:"name",value:a,onChange:s=>i(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"phone",children:"Phone Number"}),e.jsx(k,{id:"phone",value:d,readOnly:!0,disabled:!0,className:"bg-muted cursor-not-allowed"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"city",children:"City"}),e.jsxs(Y,{value:r,onValueChange:s=>j(s),children:[e.jsx(G,{className:"w-full",children:e.jsx(K,{placeholder:"Select city"})}),e.jsx(Q,{children:e.jsx(W,{value:"Bareilly",children:"Bareilly"})})]})]}),e.jsx(T,{variant:"default",disabled:m,onClick:async()=>{const s=localStorage.getItem("userId")||"";if(!s){x.error("Please log in to save changes");return}if(!a.trim()||!r.trim()){x.error("Name and city are required");return}try{B(!0);const t=await ae(s,a.trim(),r.trim(),d);t.success?(localStorage.setItem("userName",a.trim()),localStorage.setItem("userCity",r.trim()),x.success(t.message||"Profile updated")):x.error(t.message||"Failed to update profile")}catch(t){x.error((t==null?void 0:t.message)||"Could not update profile")}finally{B(!1)}},children:m?"Saving...":"Save Changes"})]})]})})]})]})]})};export{he as default};
